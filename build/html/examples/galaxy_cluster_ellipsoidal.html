
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Creating Ellipsoidal Galaxy Clusters &#8212; Pisces  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/galaxy_cluster_ellipsoidal';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Pisces  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Pisces User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Pisces User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Creating Ellipsoidal Galaxy Clusters</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Creating-Ellipsoidal-Galaxy-Clusters">
<h1>Creating Ellipsoidal Galaxy Clusters<a class="headerlink" href="#Creating-Ellipsoidal-Galaxy-Clusters" title="Link to this heading">#</a></h1>
<img alt="author_button" src="https://img.shields.io/badge/Written_By:-Eliza_Diggins-blue" />
<hr class="docutils" />
<p>This example will walk you through generating an <strong>elliptical galaxy cluster</strong> using Pisces. We can follow almost the exact same procedure as the spherical case; however, a couple of adjustments are necessary to ensure that our solution is reasonable.</p>
<section id="Coordinate-System">
<h2>Coordinate System<a class="headerlink" href="#Coordinate-System" title="Link to this heading">#</a></h2>
<p>In this example, we’ll generate two models with two different coordinate systems. In the first one, we’ll generate a spherically symmetric system and in the other we’ll create a spheroidal model. The spheroidal model will use <code class="docutils literal notranslate"><span class="pre">OblateHomoeoidalCoordinateSystem</span></code> to manage the computation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the Homoeoidal coordinate system from</span>
<span class="c1"># the geometry module.</span>
<span class="kn">from</span> <span class="nn">pisces.geometry.coordinate_systems</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">OblateHomoeoidalCoordinateSystem</span><span class="p">,</span>
    <span class="n">SphericalCoordinateSystem</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Generate the coordinate system.</span>
<span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">OblateHomoeoidalCoordinateSystem</span><span class="p">(</span><span class="n">ecc</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">sph_coordinate_system</span> <span class="o">=</span> <span class="n">SphericalCoordinateSystem</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Pisces : [INFO     ] 2025-02-25 10:06:09,020 Preparing Lame Coefficients for OblateHomoeoidalCoordinateSystem instance. This may take a few seconds...
Pisces : [INFO     ] 2025-02-25 10:06:09,663 Preparing derived attributes for OblateHomoeoidalCoordinateSystem instance. This may take a few seconds...
Pisces : [INFO     ] 2025-02-25 10:06:10,268 Lambdifying attributes...
Pisces : [INFO     ] 2025-02-25 10:06:10,787 Preparing Lame Coefficients for SphericalCoordinateSystem instance. This may take a few seconds...
Pisces : [INFO     ] 2025-02-25 10:06:10,794 Preparing derived attributes for SphericalCoordinateSystem instance. This may take a few seconds...
Pisces : [INFO     ] 2025-02-25 10:06:10,796 Lambdifying attributes...
</pre></div></div>
</div>
<p><strong>Note</strong>: You’ll notice both <code class="docutils literal notranslate"><span class="pre">OblateHomoeoidalCoordinateSystem</span></code> and <code class="docutils literal notranslate"><span class="pre">OblateSpheroidalCoordinateSystem</span></code> are available. The difference between the two is that the level-surfaces for the <span class="math notranslate nohighlight">\(r\)</span> coordinate are concentric <a class="reference external" href="https://en.wikipedia.org/wiki/Homoeoid">homoeoids</a> in the first case and <strong>confocal</strong> <a class="reference external" href="https://en.wikipedia.org/wiki/Spheroid">spheroids</a> in the later.</p>
</section>
<section id="Density-Profiles">
<h2>Density Profiles<a class="headerlink" href="#Density-Profiles" title="Link to this heading">#</a></h2>
<p>Let’s now construct the density profiles to generate the galaxy cluster from. We’ll follow the same procedures we used in the spherical case and construct 2 NFW profiles; however, the properties need to be a bit different this time.</p>
<p>In spherical coordinates, the total mass at a given value of <span class="math notranslate nohighlight">\(r\)</span> is</p>
<div class="math notranslate nohighlight">
\[M(&lt;r) = 4\pi \int_0^r \rho(\xi)\xi^2\,d\xi.\]</div>
<p>The ellipsoidal case is somewhat less simple - In a generic coordinate system <span class="math notranslate nohighlight">\((x^1,\ldots,x^N)\)</span>, the mass of a given coordinate volume depends on the Jacobian:</p>
<div class="math notranslate nohighlight">
\[M(V) = \int_V J(x^1,\ldots,x^N) \; dx^1\cdots dx^N.\]</div>
<p>In homoeoidal coordinates,</p>
<div class="math notranslate nohighlight">
\[M(&lt;r) = \int_0^r \xi^2\;d\xi \int_{S(r)} \tilde{J}(\theta,\phi) d\theta d\phi,\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde{J}\)</span> is the “angular” Jacobian. In general, homoeoidal coordinate systems do not have a simple expression for the integral above; however, in Pisces it is pre-computed during the initialization of the system:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the shell coefficient from the coordinate system object.</span>
<span class="n">shell_coefficient</span> <span class="o">=</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">shell_parameter</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The shell coefficient is </span><span class="si">{</span><span class="n">shell_coefficient</span><span class="si">}</span><span class="s2">. (4*pi*</span><span class="si">{</span><span class="n">shell_coefficient</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The shell coefficient is 25.39674993976429. (4*pi*2.021009145691141)
</pre></div></div>
</div>
<hr class="docutils" />
<p>Thus, for the same density, the mass of the homoeoidal distribution will be considerably larger. For this reason we choose to normalize the density profiles so that both systems have the same total mass at each radii.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the NFW profiles from the profiles.density module and initialize them</span>
<span class="kn">from</span> <span class="nn">pisces.profiles.density</span> <span class="kn">import</span> <span class="n">NFWDensityProfile</span>

<span class="c1"># Create the halo and gas profiles.</span>
<span class="n">halo_profile_sph</span> <span class="o">=</span> <span class="n">NFWDensityProfile</span><span class="p">(</span><span class="n">rho_0</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">r_s</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">gas_profile_sph</span> <span class="o">=</span> <span class="n">NFWDensityProfile</span><span class="p">(</span><span class="n">rho_0</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">r_s</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="c1"># Use the shell coefficient to normalize the non-spherical distributions</span>
<span class="c1"># so that we get the same total mass.</span>
<span class="n">corr_factor</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">shell_coefficient</span>
<span class="n">halo_profile_elp</span> <span class="o">=</span> <span class="n">NFWDensityProfile</span><span class="p">(</span><span class="n">rho_0</span><span class="o">=</span><span class="mf">1e7</span> <span class="o">*</span> <span class="n">corr_factor</span><span class="p">,</span> <span class="n">r_s</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">gas_profile_elp</span> <span class="o">=</span> <span class="n">NFWDensityProfile</span><span class="p">(</span><span class="n">rho_0</span><span class="o">=</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">corr_factor</span><span class="p">,</span> <span class="n">r_s</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the two profiles over a characteristic range of radii.</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Create the abscissa for the plot.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>


<span class="c1"># Generate the plot and plot the data.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Plot out the density functions.</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">halo_profile_sph</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rho_{\rm sph, dyn}(r)$&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">gas_profile_sph</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rho_{\rm sph, g}(r)$&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">halo_profile_elp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rho_{\rm ell, dyn}(r)$&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">gas_profile_elp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rho_{\rm ell, g}(r)$&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radii, [kpc]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Density, $\left[{\rm M_\odot / kpc^3}\right]$&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Compute the internal mass functions</span>
<span class="n">spherical_halo_mass</span> <span class="o">=</span> <span class="n">sph_coordinate_system</span><span class="o">.</span><span class="n">integrate_in_shells</span><span class="p">(</span><span class="n">halo_profile_sph</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<span class="n">homoeoidal_halo_mass</span> <span class="o">=</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">integrate_in_shells</span><span class="p">(</span><span class="n">halo_profile_elp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<span class="n">spherical_gas_mass</span> <span class="o">=</span> <span class="n">sph_coordinate_system</span><span class="o">.</span><span class="n">integrate_in_shells</span><span class="p">(</span><span class="n">gas_profile_sph</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<span class="n">homoeoidal_gas_mass</span> <span class="o">=</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">integrate_in_shells</span><span class="p">(</span><span class="n">gas_profile_elp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">spherical_halo_mass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$M_{\rm sph, dyn}(r)$&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">homoeoidal_halo_mass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$M_{\rm sph, g}(r)$&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">spherical_gas_mass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$M_{\rm ell, dyn}(r)$&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">homoeoidal_gas_mass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$M_{\rm ell, g}(r)$&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radii, [kpc]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Total Mass, $\left[{\rm M_\odot}\right]$&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x16807cbc0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_galaxy_cluster_ellipsoidal_7_1.png" src="../_images/examples_galaxy_cluster_ellipsoidal_7_1.png" />
</div>
</div>
</section>
<section id="Generating-the-Model">
<h2>Generating the Model<a class="headerlink" href="#Generating-the-Model" title="Link to this heading">#</a></h2>
<p>Now that we have the coordinate system sorted out and the density profiles created, we can generate the model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pisces.models.galaxy_clusters</span> <span class="kn">import</span> <span class="n">ClusterModel</span>

<span class="n">cluster_model_ellipsoidal</span> <span class="o">=</span> <span class="n">ClusterModel</span><span class="o">.</span><span class="n">from_dens_and_tden</span><span class="p">(</span>
    <span class="s2">&quot;cluster_model_ellipsoid.hdf5&quot;</span><span class="p">,</span>
    <span class="mf">1e-1</span><span class="p">,</span>
    <span class="mf">1e4</span><span class="p">,</span>
    <span class="n">gas_profile_elp</span><span class="p">,</span>
    <span class="n">halo_profile_elp</span><span class="p">,</span>
    <span class="mi">1000</span><span class="p">,</span>
    <span class="n">n_theta</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">coordinate_system</span><span class="o">=</span><span class="n">coordinate_system</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ClusterModel : [INFO     ] [BLDR] Building model skeleton at path: cluster_model_ellipsoid.hdf5
ClusterModel : [DEBUG    ] [BLDR] HDF5 file created successfully.
ClusterModel : [DEBUG    ] [BLDR] Grid manager skeleton built successfully.
ClusterModel : [DEBUG    ] Profile &#39;gas_density&#39; added successfully.
ClusterModel : [DEBUG    ] Profile &#39;total_density&#39; added successfully.
ClusterModel : [INFO     ] [BLDR] Model skeleton created successfully at &#39;cluster_model_ellipsoid.hdf5&#39;.
ClusterModel : [INFO     ] [LOAD] Loading model from file: cluster_model_ellipsoid.hdf5...
Pisces : [INFO     ] 2025-02-25 10:06:51,932 Preparing Lame Coefficients for OblateHomoeoidalCoordinateSystem instance. This may take a few seconds...
Pisces : [INFO     ] 2025-02-25 10:06:52,385 Preparing derived attributes for OblateHomoeoidalCoordinateSystem instance. This may take a few seconds...
Pisces : [INFO     ] 2025-02-25 10:06:52,959 Lambdifying attributes...
ClusterModel : [INFO     ] [LOAD] COMPLETE: cluster_model_ellipsoid.hdf5
ClusterModel : [INFO     ] [EXEC] Solving model &lt;ClusterModel: path=cluster_model_ellipsoid.hdf5&gt;.
ClusterModel : [INFO     ] [EXEC]       PATHWAY = homoeoidal_dens_tden.
ClusterModel : [INFO     ] [EXEC]       NUM_STEPS = 6.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6b336afa901f463bb3a10cabaf4ed326", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ClusterModel : [INFO     ] [EXEC]       (1/6) START: `convert_profiles_to_fields`.
ClusterModel : [DEBUG    ] [EXEC]               Added field `gas_density` (units=Msun/kpc**3) from profile.
ClusterModel : [DEBUG    ] [EXEC]               Added field `total_density` (units=Msun/kpc**3) from profile.
ClusterModel : [DEBUG    ] [EXEC]               Added field `stellar_density` (units=Msun/kpc**3) as null.
ClusterModel : [INFO     ] [EXEC]       (1/6) COMPLETE: `convert_profiles_to_fields`.
ClusterModel : [INFO     ] [EXEC]       (2/6) START: `perform_mass_accounting`.
ClusterModel : [DEBUG    ] [EXEC] Added field &#39;dark_matter_density&#39; (units=Msun/kpc**3, ndim=1).
ClusterModel : [INFO     ] [EXEC]       (2/6) COMPLETE: `perform_mass_accounting`.
ClusterModel : [INFO     ] [EXEC]       (3/6) START: `integrate_density_fields`.
ClusterModel : [INFO     ] [EXEC]       (3/6) COMPLETE: `integrate_density_fields`.
ClusterModel : [INFO     ] [EXEC]       (4/6) START: `solve_poisson_problem`.
ClusterModel : [DEBUG    ] [EXEC] Added field &#39;gravitational_potential&#39; (units=m**2/s**2, ndim=2).
ClusterModel : [INFO     ] [EXEC]       (4/6) COMPLETE: `solve_poisson_problem`.
ClusterModel : [INFO     ] [EXEC]       (5/6) START: `solve_hse_asymmetric`.
ClusterModel : [DEBUG    ] [EXEC] Added field &#39;pressure&#39; (units=atm, ndim=2).
ClusterModel : [INFO     ] [EXEC]       (5/6) COMPLETE: `solve_hse_asymmetric`.
ClusterModel : [INFO     ] [EXEC]       (6/6) START: `solve_eos`.
ClusterModel : [DEBUG    ] [EXEC] Added field &#39;temperature&#39; (units=keV, ndim=2).
ClusterModel : [INFO     ] [EXEC]       (6/6) COMPLETE: `solve_eos`.
ClusterModel : [INFO     ] [EXEC] Successfully executed pathway &#39;homoeoidal_dens_tden&#39;.
</pre></div></div>
</div>
<p>This is a much more complex procedure and will produce models which lose their radial symmetry. We can also generate the equivalent spherical system for comparison:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the spherical equivalent.</span>
<span class="n">cluster_model_spherical</span> <span class="o">=</span> <span class="n">ClusterModel</span><span class="o">.</span><span class="n">from_dens_and_tden</span><span class="p">(</span>
    <span class="s2">&quot;cluster_model_spherical.hdf5&quot;</span><span class="p">,</span>
    <span class="mf">1e-1</span><span class="p">,</span>
    <span class="mf">1e4</span><span class="p">,</span>
    <span class="n">gas_profile_sph</span><span class="p">,</span>
    <span class="n">halo_profile_sph</span><span class="p">,</span>
    <span class="mi">1000</span><span class="p">,</span>
    <span class="n">coordinate_system</span><span class="o">=</span><span class="n">sph_coordinate_system</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ClusterModel : [INFO     ] [BLDR] Building model skeleton at path: cluster_model_spherical.hdf5
ClusterModel : [DEBUG    ] [BLDR] HDF5 file created successfully.
ClusterModel : [DEBUG    ] [BLDR] Grid manager skeleton built successfully.
ClusterModel : [DEBUG    ] Profile &#39;gas_density&#39; added successfully.
ClusterModel : [DEBUG    ] Profile &#39;total_density&#39; added successfully.
ClusterModel : [INFO     ] [BLDR] Model skeleton created successfully at &#39;cluster_model_spherical.hdf5&#39;.
ClusterModel : [INFO     ] [LOAD] Loading model from file: cluster_model_spherical.hdf5...
Pisces : [INFO     ] 2025-01-27 14:36:30,039 Preparing Lame Coefficients for SphericalCoordinateSystem instance. This may take a few seconds...
Pisces : [INFO     ] 2025-01-27 14:36:30,044 Preparing derived attributes for SphericalCoordinateSystem instance. This may take a few seconds...
Pisces : [INFO     ] 2025-01-27 14:36:30,047 Lambdifying attributes...
ClusterModel : [INFO     ] [LOAD] COMPLETE: cluster_model_spherical.hdf5
ClusterModel : [INFO     ] [EXEC] Solving model &lt;ClusterModel: path=cluster_model_spherical.hdf5&gt;.
ClusterModel : [INFO     ] [EXEC]       PATHWAY = spherical_dens_tden.
ClusterModel : [INFO     ] [EXEC]       NUM_STEPS = 6.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "255fc1316b844656865dc4a069a1afe9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ClusterModel : [INFO     ] [EXEC]       (1/6) START: `convert_profiles_to_fields`.
ClusterModel : [DEBUG    ] [EXEC]               Added field `gas_density` (units=Msun/kpc**3) from profile.
ClusterModel : [DEBUG    ] [EXEC]               Added field `total_density` (units=Msun/kpc**3) from profile.
ClusterModel : [DEBUG    ] [EXEC]               Added field `stellar_density` (units=Msun/kpc**3) as null.
ClusterModel : [INFO     ] [EXEC]       (1/6) COMPLETE: `convert_profiles_to_fields`.
ClusterModel : [INFO     ] [EXEC]       (2/6) START: `perform_mass_accounting`.
ClusterModel : [DEBUG    ] [EXEC] Added field &#39;dark_matter_density&#39; (units=Msun/kpc**3, ndim=1).
ClusterModel : [INFO     ] [EXEC]       (2/6) COMPLETE: `perform_mass_accounting`.
ClusterModel : [INFO     ] [EXEC]       (3/6) START: `integrate_density_fields`.
ClusterModel : [INFO     ] [EXEC]       (3/6) COMPLETE: `integrate_density_fields`.
ClusterModel : [INFO     ] [EXEC]       (4/6) START: `solve_poisson_problem`.
ClusterModel : [DEBUG    ] [EXEC] Added field &#39;gravitational_potential&#39; (units=m**2/s**2, ndim=1).
ClusterModel : [INFO     ] [EXEC]       (4/6) COMPLETE: `solve_poisson_problem`.
ClusterModel : [INFO     ] [EXEC]       (5/6) START: `solve_hse`.
ClusterModel : [DEBUG    ] [EXEC] Added field &#39;pressure&#39; (units=atm, ndim=1).
ClusterModel : [INFO     ] [EXEC]       (5/6) COMPLETE: `solve_hse`.
ClusterModel : [INFO     ] [EXEC]       (6/6) START: `solve_eos`.
ClusterModel : [DEBUG    ] [EXEC] Added field &#39;temperature&#39; (units=keV, ndim=1).
ClusterModel : [INFO     ] [EXEC]       (6/6) COMPLETE: `solve_eos`.
ClusterModel : [INFO     ] [EXEC] Successfully executed pathway &#39;spherical_dens_tden&#39;.
</pre></div></div>
</div>
<section id="Working-with-the-Results">
<h3>Working with the Results<a class="headerlink" href="#Working-with-the-Results" title="Link to this heading">#</a></h3>
<p>As a general tour of the available information provided by each of the models we’ve generated, let’s do some digging and look at the various physical components of the models:</p>
</section>
</section>
<section id="Summaries">
<h2>Summaries<a class="headerlink" href="#Summaries" title="Link to this heading">#</a></h2>
<p>Summaries are available for every model including the available fields, profiles, and other properties.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a summary of the entire model</span>
<span class="n">cluster_model_ellipsoidal</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

===================== Model Summary =====================

General Information:
--------------------
+-----------------+------------------------------+
| Attribute       | Value                        |
+=================+==============================+
| Path            | cluster_model_ellipsoid.hdf5 |
+-----------------+------------------------------+
| Solved          | True                         |
+-----------------+------------------------------+
| Default Pathway | None                         |
+-----------------+------------------------------+

Available Fields:
-----------------
+-------------------------+-------------+-------------+---------------+--------+
| Field Name              | Units       | Shape       | Axes          |   Ndim |
+=========================+=============+=============+===============+========+
| gas_density             | Msun/kpc**3 | (1000,)     | [&#39;r&#39;]         |      1 |
+-------------------------+-------------+-------------+---------------+--------+
| total_density           | Msun/kpc**3 | (1000,)     | [&#39;r&#39;]         |      1 |
+-------------------------+-------------+-------------+---------------+--------+
| stellar_density         | Msun/kpc**3 | (1000,)     | [&#39;r&#39;]         |      1 |
+-------------------------+-------------+-------------+---------------+--------+
| gas_mass                | Msun        | (1000,)     | [&#39;r&#39;]         |      1 |
+-------------------------+-------------+-------------+---------------+--------+
| stellar_mass            | Msun        | (1000,)     | [&#39;r&#39;]         |      1 |
+-------------------------+-------------+-------------+---------------+--------+
| dark_matter_density     | Msun/kpc**3 | (1000,)     | [&#39;r&#39;]         |      1 |
+-------------------------+-------------+-------------+---------------+--------+
| dark_matter_mass        | Msun        | (1000,)     | [&#39;r&#39;]         |      1 |
+-------------------------+-------------+-------------+---------------+--------+
| total_mass              | Msun        | (1000,)     | [&#39;r&#39;]         |      1 |
+-------------------------+-------------+-------------+---------------+--------+
| gravitational_potential | m**2/s**2   | (1000, 100) | [&#39;r&#39; &#39;theta&#39;] |      2 |
+-------------------------+-------------+-------------+---------------+--------+
| pressure                | atm         | (1000, 100) | [&#39;r&#39; &#39;theta&#39;] |      2 |
+-------------------------+-------------+-------------+---------------+--------+
| temperature             | keV         | (1000, 100) | [&#39;r&#39; &#39;theta&#39;] |      2 |
+-------------------------+-------------+-------------+---------------+--------+

Available Profiles:
-------------------
+----------------+-------------------+------------------------------+--------+-------------+
| Profile Name   | Type              | Parameters                   | Axes   | Units       |
+================+===================+==============================+========+=============+
| total_density  | NFWDensityProfile | rho_0=4.948e+06, r_s=2.e+02  | [&#39;r&#39;]  | Msun/kpc**3 |
+----------------+-------------------+------------------------------+--------+-------------+
| gas_density    | NFWDensityProfile | rho_0=4.948e+05, r_s=1.5e+02 | [&#39;r&#39;]  | Msun/kpc**3 |
+----------------+-------------------+------------------------------+--------+-------------+

Grid Information:
-----------------
+--------+--------+----------+------+------------+----------------+----------------+---------+
| Axis   |   Min. |     Max. |    N |   N Chunks | Cell Size      | Chunk Size     | Scale   |
+========+========+==========+======+============+================+================+=========+
| r      |   0.1  | 10000    | 1000 |          1 | 5.e-03 - log   | 5.e+00 - log   | log     |
+--------+--------+----------+------+------------+----------------+----------------+---------+
| theta  |   0    |     3.14 |  100 |          1 | 3.14e-02 - lin | 3.14e+00 - lin | linear  |
+--------+--------+----------+------+------------+----------------+----------------+---------+
| phi    |  -3.14 |     3.14 |    1 |          1 | 6.28e+00 - lin | 6.28e+00 - lin | linear  |
+--------+--------+----------+------+------------+----------------+----------------+---------+

=========================================================

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_model_spherical</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

===================== Model Summary =====================

General Information:
--------------------
+-----------------+------------------------------+
| Attribute       | Value                        |
+=================+==============================+
| Path            | cluster_model_spherical.hdf5 |
+-----------------+------------------------------+
| Solved          | True                         |
+-----------------+------------------------------+
| Default Pathway | None                         |
+-----------------+------------------------------+

Available Fields:
-----------------
+-------------------------+-------------+---------+--------+--------+
| Field Name              | Units       | Shape   | Axes   |   Ndim |
+=========================+=============+=========+========+========+
| gas_density             | Msun/kpc**3 | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| total_density           | Msun/kpc**3 | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| stellar_density         | Msun/kpc**3 | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| gas_mass                | Msun        | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| stellar_mass            | Msun        | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| dark_matter_density     | Msun/kpc**3 | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| dark_matter_mass        | Msun        | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| total_mass              | Msun        | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| gravitational_potential | m**2/s**2   | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| pressure                | atm         | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+
| temperature             | keV         | (1000,) | [&#39;r&#39;]  |      1 |
+-------------------------+-------------+---------+--------+--------+

Available Profiles:
-------------------
+----------------+-------------------+---------------------------+--------+-------------+
| Profile Name   | Type              | Parameters                | Axes   | Units       |
+================+===================+===========================+========+=============+
| total_density  | NFWDensityProfile | rho_0=1.e+07, r_s=2.e+02  | [&#39;r&#39;]  | Msun/kpc**3 |
+----------------+-------------------+---------------------------+--------+-------------+
| gas_density    | NFWDensityProfile | rho_0=1.e+06, r_s=1.5e+02 | [&#39;r&#39;]  | Msun/kpc**3 |
+----------------+-------------------+---------------------------+--------+-------------+

Grid Information:
-----------------
+--------+--------+----------+------+------------+----------------+----------------+---------+
| Axis   |   Min. |     Max. |    N |   N Chunks | Cell Size      | Chunk Size     | Scale   |
+========+========+==========+======+============+================+================+=========+
| r      |   0.1  | 10000    | 1000 |          1 | 5.e-03 - log   | 5.e+00 - log   | log     |
+--------+--------+----------+------+------------+----------------+----------------+---------+
| theta  |   0    |     3.14 |    1 |          1 | 3.14e+00 - lin | 3.14e+00 - lin | linear  |
+--------+--------+----------+------+------------+----------------+----------------+---------+
| phi    |  -3.14 |     3.14 |    1 |          1 | 6.28e+00 - lin | 6.28e+00 - lin | linear  |
+--------+--------+----------+------+------------+----------------+----------------+---------+

=========================================================

</pre></div></div>
</div>
</section>
<section id="Generating-Field-Plots">
<h2>Generating Field Plots<a class="headerlink" href="#Generating-Field-Plots" title="Link to this heading">#</a></h2>
<p>We can also generate plots of the various different fields in the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================== #</span>
<span class="c1"># Density / Mass Plots            #</span>
<span class="c1"># =============================== #</span>
<span class="c1"># Fetch the radii from the cluster models.</span>
<span class="n">x_sph</span><span class="p">,</span> <span class="n">x_ell</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">cluster_model_spherical</span><span class="o">.</span><span class="n">get_radii</span><span class="p">(),</span>
    <span class="n">cluster_model_ellipsoidal</span><span class="o">.</span><span class="n">get_radii</span><span class="p">(),</span>
<span class="p">)</span>

<span class="c1"># Generate and plot the figure.</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">dfield</span><span class="p">,</span> <span class="n">mfield</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;gas_density&quot;</span><span class="p">,</span> <span class="s2">&quot;total_density&quot;</span><span class="p">,</span> <span class="s2">&quot;dark_matter_density&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;gas_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;total_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;dark_matter_mass&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span>
<span class="p">):</span>
    <span class="c1"># Plot the density values.</span>
    <span class="n">y_sph</span><span class="p">,</span> <span class="n">y_ell</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cluster_model_spherical</span><span class="o">.</span><span class="n">FIELDS</span><span class="p">[</span><span class="n">dfield</span><span class="p">][</span><span class="o">...</span><span class="p">],</span>
        <span class="n">cluster_model_ellipsoidal</span><span class="o">.</span><span class="n">FIELDS</span><span class="p">[</span><span class="n">dfield</span><span class="p">][</span><span class="o">...</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x_sph</span><span class="p">,</span> <span class="n">y_sph</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">dfield</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x_ell</span><span class="p">,</span> <span class="n">y_ell</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

    <span class="c1"># Plot the mass values.</span>
    <span class="n">y_sph</span><span class="p">,</span> <span class="n">y_ell</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cluster_model_spherical</span><span class="o">.</span><span class="n">FIELDS</span><span class="p">[</span><span class="n">mfield</span><span class="p">][</span><span class="o">...</span><span class="p">],</span>
        <span class="n">cluster_model_ellipsoidal</span><span class="o">.</span><span class="n">FIELDS</span><span class="p">[</span><span class="n">mfield</span><span class="p">][</span><span class="o">...</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x_sph</span><span class="p">,</span> <span class="n">y_sph</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">mfield</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x_ell</span><span class="p">,</span> <span class="n">y_ell</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>


<span class="c1"># Add labels and other needed components to the plots.</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radii, [kpc]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Density, $\left[{\rm M_\odot / kpc^3}\right]$&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radii, [kpc]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Mass, $\left[{\rm M_\odot}\right]$&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_galaxy_cluster_ellipsoidal_16_0.png" src="../_images/examples_galaxy_cluster_ellipsoidal_16_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create images of the temperature.</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create the normalization.</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;inferno&quot;</span>

<span class="n">t_e</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cluster_model_ellipsoidal</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span>
    <span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">view_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">noplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">t_s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cluster_model_spherical</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span>
    <span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">view_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">noplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">td_e</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cluster_model_ellipsoidal</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span>
    <span class="s2">&quot;total_density&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">view_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">noplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">td_s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cluster_model_spherical</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span>
    <span class="s2">&quot;total_density&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">view_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">noplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># X,Y = np.meshgrid(np.linspace(*extent[:2],500),np.linspace(*extent[2:],500))</span>
<span class="c1">#</span>
<span class="n">im0</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">td_e</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">td_s</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t_e</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;hot&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t_s</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;hot&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
    <span class="n">im0</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">fraction</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Log Density, $\left[{\rm M_{\odot} \; kpc^{-3}}\right]$&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;T, $\left[{\rm keV}\right]$&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Z, [kpc]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Z, [kpc]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X, [kpc]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X, [kpc]&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;test.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_galaxy_cluster_ellipsoidal_18_0.png" src="../_images/examples_galaxy_cluster_ellipsoidal_18_0.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Coordinate-System">Coordinate System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Density-Profiles">Density Profiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Generating-the-Model">Generating the Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Working-with-the-Results">Working with the Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Summaries">Summaries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Generating-Field-Plots">Generating Field Plots</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/examples/galaxy_cluster_ellipsoidal.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Eliza Diggins.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>