
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pisces.profiles.base &#8212; Pisces  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pisces/profiles/base';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Pisces  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../reference/index.html">
    Pisces User Guide
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../reference/index.html">
    Pisces User Guide
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">pisces.profiles.base</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for pisces.profiles.base</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Profile base classes.</span>

<span class="sd">Profiles are one of the core components of Pisces, enabling users to model and manipulate mathematical profiles</span>
<span class="sd">with symbolic and numerical capabilities. Profiles can represent various physical and mathematical entities, such as</span>
<span class="sd">density, mass, or temperature distributions.</span>

<span class="sd">For readers who are not familiar with the usage of profiles, we suggest reading :ref:`profiles_overview`. For developers,</span>
<span class="sd">the :ref:`profiles_developers` is worth a read before diving into the API.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">unyt</span> <span class="kn">import</span> <span class="n">Unit</span>

<span class="kn">from</span> <span class="nn">pisces.utilities.general</span> <span class="kn">import</span> <span class="n">find_in_subclasses</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span>

<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="kn">from</span> <span class="nn">pisces.utilities.logging</span> <span class="kn">import</span> <span class="n">devlog</span>


<div class="viewcode-block" id="class_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.class_expression.html#pisces.profiles.base.class_expression">[docs]</a>
<span class="k">def</span> <span class="nf">class_expression</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">on_demand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator to register a symbolic expression at the class level.</span>

<span class="sd">    This decorator is designed to streamline the definition of class-level symbolic expressions for subclasses of</span>
<span class="sd">    :py:class:`Profile`. These expressions are derived from the symbolic representation of the profile&#39;s function</span>
<span class="sd">    and are shared across all instances of the class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        The name of the derived symbolic expression. If not provided, the name of the decorated method will be used.</span>
<span class="sd">        This is the name by which the expression is registered and then looked up by the user. It therefore should</span>
<span class="sd">        generally be intuitive.</span>
<span class="sd">    on_demand : bool, optional</span>
<span class="sd">        If ``True`` (default), this won&#39;t be loaded until it is requested. Otherwise it is loaded as soon as the</span>
<span class="sd">        class is instantiated.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Callable</span>
<span class="sd">        The decorated method.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    To use this decorator, define a method in your :py:class:`Profile` subclass that computes the desired symbolic</span>
<span class="sd">    expression. The decorated method must have the following signature:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        class ProfileClass(Profile):</span>

<span class="sd">            @class_expression(name=&#39;my_expression&#39;)</span>
<span class="sd">            def method(</span>
<span class="sd">                axes: List[sp.Symbol],</span>
<span class="sd">                parameters: Dict[str, sp.Symbol],</span>
<span class="sd">                expression: sp.Basic): -&gt; sp.Basic</span>

<span class="sd">                # Insert the code to manipulate the axes, parameters, and expression</span>
<span class="sd">                # as needed here.</span>

<span class="sd">                return expression</span>

<span class="sd">    Here, the arguments are as follows:</span>

<span class="sd">    - **axes**: A list of ``sympy.Symbol`` objects representing the symbolic axes of the profile.</span>
<span class="sd">    - **parameters**: A dictionary mapping parameter names to their ``sympy.Symbol`` representations.</span>
<span class="sd">    - **expression**: The symbolic function of the profile.</span>

<span class="sd">    The decorated method should return a symbolic expression derived from these inputs. The returned expression is</span>
<span class="sd">    automatically registered at the class level under the specified or inferred name.</span>

<span class="sd">    Tips</span>
<span class="sd">    ----</span>
<span class="sd">    - Use this decorator for expressions that are static and depend only on the symbolic representation of the profile,</span>
<span class="sd">      not on instance-specific parameters.</span>
<span class="sd">    - Derived expressions can be used to add meaningful symbolic attributes to the class, such as analytical derivatives</span>
<span class="sd">      or scaling factors.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">wrapper</span><span class="o">.</span><span class="n">class_expression</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">expression_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">on_demand</span> <span class="o">=</span> <span class="n">on_demand</span>
        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span></div>



<span class="c1"># noinspection PyTypeChecker</span>
<div class="viewcode-block" id="ProfileMeta">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.ProfileMeta.html#pisces.profiles.base.ProfileMeta">[docs]</a>
<span class="k">class</span> <span class="nc">ProfileMeta</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A metaclass for managing Profile subclasses with automatic symbolic attribute generation.</span>

<span class="sd">    This metaclass handles the following tasks:</span>

<span class="sd">    1. Generates symbolic representations (``SYMBAXES``, ``SYMBPARAMS``, ``_func_expr``) for axes,</span>
<span class="sd">       parameters, and the class-level ``_function``.</span>
<span class="sd">    2. Derive additional symbolic expressions for the class.</span>

<span class="sd">    Abstract classes are ignored for both registration and symbolic generation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="n">mcs</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;ProfileMeta&quot;</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">bases</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">clsdict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new class, handle registration, and generate symbolic attributes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mcs : Type[ProfileMeta]</span>
<span class="sd">            The metaclass itself.</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the class being created.</span>
<span class="sd">        bases : tuple</span>
<span class="sd">            The base classes of the class being created.</span>
<span class="sd">        clsdict : dict</span>
<span class="sd">            Dictionary containing the attributes and methods of the class being created.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Type</span>
<span class="sd">            The newly created class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Identify if the class is abstract or concrete. This step is necessary so that</span>
        <span class="c1"># we don&#39;t force abstract classes to have properties which are not necessary given</span>
        <span class="c1"># that they are never instantiated.</span>
        <span class="n">is_abstract</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_IS_ABC&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Create the base class object without adulteration from the</span>
        <span class="c1"># metaclass.</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">)</span>

        <span class="c1"># If the class is not an abstract base class, we need to register</span>
        <span class="c1"># symbols and parse the relevant class-level expressions.</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_abstract</span><span class="p">:</span>
            <span class="n">mcs</span><span class="o">.</span><span class="n">_generate_symbolics</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="n">mcs</span><span class="o">.</span><span class="n">_register_class_expressions</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_generate_symbolics</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Profile&quot;</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate symbolic representations for axes, parameters, and the function expression of a Profile class.</span>

<span class="sd">        This method processes the `AXES`, `DEFAULT_PARAMETERS`, and `_function` attributes of a Profile subclass to create</span>
<span class="sd">        symbolic representations used throughout the class. Specifically, it:</span>

<span class="sd">        1. Converts the string representations in `AXES` to `sympy.Symbol` `objects, stored in `SYMBAXES`.</span>
<span class="sd">        2. Converts the dictionary keys in `DEFAULT_PARAMETERS` to `sympy.Symbol` objects, stored in `SYMBPARAMS`.</span>
<span class="sd">        3. Evaluates the `_function` callable using the symbolic axes and parameters to produce a symbolic</span>
<span class="sd">           representation of the function, stored in `_func_expr`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cls : Type[&#39;Profile&#39;]</span>
<span class="sd">            The Profile subclass for which symbolic representations are generated.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If any of the following conditions are met:</span>

<span class="sd">            - The class is missing the `AXES` attribute.</span>
<span class="sd">            - The class is missing the `DEFAULT_PARAMETERS` attribute.</span>
<span class="sd">            - The class is missing a callable `_function` attribute.</span>
<span class="sd">            - The symbolic function generation fails (e.g., due to invalid inputs or function definition).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - This method assumes that the `AXES` attribute is a list of strings and `DEFAULT_PARAMETERS` is a dictionary with string keys.</span>
<span class="sd">        - `_function` must be a callable that accepts the symbolic axes and parameters as arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate that we have the necessary basic attributes.</span>
        <span class="n">AXES</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;AXES&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">DEFAULT_PARAMETERS</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;DEFAULT_PARAMETERS&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">AXES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class attribute `AXES` is missing in &#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">DEFAULT_PARAMETERS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Class attribute `DEFAULT_PARAMETERS` is missing in &#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">_func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Class attribute `_function` is missing or not callable in &#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Convert AXES to symbolic representation</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">SYMBAXES</span> <span class="o">=</span> <span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">AXES</span><span class="p">]</span>

        <span class="c1"># Convert DEFAULT_PARAMETERS to symbolic representation</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">SYMBPARAMS</span> <span class="o">=</span> <span class="p">{</span><span class="n">param</span><span class="p">:</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">DEFAULT_PARAMETERS</span><span class="p">}</span>

        <span class="c1"># Generate the symbolic function expression</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_func_expr</span> <span class="o">=</span> <span class="n">_func</span><span class="p">(</span><span class="o">*</span><span class="bp">cls</span><span class="o">.</span><span class="n">SYMBAXES</span><span class="p">,</span> <span class="o">**</span><span class="bp">cls</span><span class="o">.</span><span class="n">SYMBPARAMS</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to generate symbolic function for &#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; due to: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_register_class_expressions</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Profile&quot;</span><span class="p">],</span> <span class="n">clsdict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register class-level symbolic expressions from decorated methods.</span>

<span class="sd">        This method identifies methods in the class dictionary (`clsdict`) that are decorated with</span>
<span class="sd">        the `@class_expression` decorator. For each such method, it:</span>

<span class="sd">        1. Retrieves the symbolic expression generated by the method using the class&#39;s symbolic axes,</span>
<span class="sd">           symbolic parameters, and main symbolic function expression (`_func_expr`).</span>
<span class="sd">        2. Registers the resulting expression under the name specified in the decorator (or the method name</span>
<span class="sd">           if not explicitly specified) using the `set_class_expression` method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cls : Type[&#39;Profile&#39;]</span>
<span class="sd">            The Profile subclass for which class-level expressions are being registered.</span>
<span class="sd">        clsdict : dict</span>
<span class="sd">            The dictionary of attributes and methods belonging to the Profile subclass.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a decorated method fails to generate a valid symbolic expression.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - This method assumes that decorated methods accept three arguments:</span>
<span class="sd">          `SYMBAXES` (list of symbolic axes), `SYMBPARAMS` (dict of symbolic parameters),</span>
<span class="sd">          and `func_expr` (the symbolic function expression of the profile).</span>
<span class="sd">        - The expressions registered via this method are shared across all instances of the Profile class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="c1"># You might skip object or other base classes if desired</span>
            <span class="k">if</span> <span class="n">base</span> <span class="ow">is</span> <span class="nb">object</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">base</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;class_expression&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">expression_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                        <span class="n">method</span><span class="p">,</span> <span class="s2">&quot;expression_name&quot;</span>
                    <span class="p">)</span>  <span class="c1"># Retrieve the name for the expression</span>
                    <span class="n">on_demand</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;on_demand&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="n">devlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Registering class expression </span><span class="si">%s</span><span class="s2"> to class </span><span class="si">%s</span><span class="s2">. (ON_DEMAND=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">expression_name</span><span class="p">,</span>
                        <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="n">on_demand</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">on_demand</span><span class="p">:</span>
                        <span class="n">devlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;Evaluating class expression </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">expression_name</span>
                        <span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Generate the symbolic expression using the method</span>
                            <span class="n">expression</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span>
                                <span class="bp">cls</span><span class="o">.</span><span class="n">SYMBAXES</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">SYMBPARAMS</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_func_expr</span>
                            <span class="p">)</span>
                            <span class="c1"># Register the expression at the class level</span>
                            <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">expression</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Failed to register class-level expression &#39;</span><span class="si">{</span><span class="n">expression_name</span><span class="si">}</span><span class="s2">&#39; for &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;class &#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; due to: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_name</span></div>



<div class="viewcode-block" id="Profile">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.html#pisces.profiles.base.Profile">[docs]</a>
<span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ProfileMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for mathematical profiles with symbolic and numerical support.</span>

<span class="sd">    This class provides a framework for defining mathematical profiles with symbolic</span>
<span class="sd">    expressions, parameterized inputs, and units. It supports automatic symbolic representation,</span>
<span class="sd">    validation of input parameters, unit handling, and serialization/deserialization.</span>

<span class="sd">    .. rubric:: Implementation Details</span>

<span class="sd">    Each :py:class:`Profile` class is characterized by only a couple of special class-level attributes:</span>

<span class="sd">    - :py:attr:`Profile.AXES`: Provides a list of the axes that can be passed to the profile. These become</span>
<span class="sd">      the arguments of the eventual ``callable`` object the user interacts with.</span>
<span class="sd">    - :py:attr:`Profile.DEFAULT_PARAMETERS`: A dictionary with parameter names as keys and their default values. This</span>
<span class="sd">      eventually becomes the ``kwargs`` that the user passes during instantiation.</span>
<span class="sd">    - :py:attr:`Profile.DEFAULT_UNITS`: A string specifying the default units of the profile. These can be overwritten later, but they</span>
<span class="sd">      do define the permissible units as user specified units which are incompatible lead to an error.</span>
<span class="sd">    - ``_function``: A class method implementing the symbolic mathematical function of the profile.</span>

<span class="sd">    With these 4 attributes defined, the :py:class:`Profile` subclass is fully functional.</span>

<span class="sd">    .. rubric:: Expressions and Derived Attributes</span>

<span class="sd">    The :py:class:`Profile` class supports both class-level and instance-level derived symbolic expressions. These</span>
<span class="sd">    derived expressions can represent additional features or properties of the profile and are managed separately from</span>
<span class="sd">    the primary symbolic expression.</span>

<span class="sd">    .. hint::</span>

<span class="sd">        The idea here is that you might want your custom profile to have certain derived attributes (like a mass profile for</span>
<span class="sd">        a particular density profile); however, these should often only be derived once -- at the class level.</span>

<span class="sd">    **Class-Level Expressions:**</span>

<span class="sd">    Class-level expressions are shared across all instances of the profile class. They are defined and accessed</span>
<span class="sd">    using the following methods:</span>

<span class="sd">    - **Define**: Use the :py:meth:`Profile.set_class_expression` method to register a symbolic expression.</span>
<span class="sd">    - **Access**: Use the :py:meth:`Profile.get_class_expression` method to retrieve a registered symbolic expression.</span>

<span class="sd">    .. dropdown:: Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from sympy import symbols</span>

<span class="sd">            class MyProfile(Profile):</span>
<span class="sd">                AXES = [&#39;x&#39;]</span>
<span class="sd">                PARAMETERS = {&#39;a&#39;: 1, &#39;b&#39;: 2}</span>
<span class="sd">                _function = lambda x, a=1, b=2: a*x**2</span>

<span class="sd">            x = MyProfile.SYMBAXES[0]</span>
<span class="sd">            a = MyProfile.SYMBPARAMETERS[&#39;a&#39;]</span>
<span class="sd">            MyProfile.set_class_expression(&#39;slope&#39;, 2*a*x )</span>
<span class="sd">            slope_symbolic = MyProfile.get_class_expression(&#39;slope&#39;)  # Returns the symbolic expression for &#39;a&#39;</span>

<span class="sd">    .. tip::</span>

<span class="sd">        For developers: Class-level expressions can also be registered automatically using the :py:func:`class_expression` decorator</span>
<span class="sd">        on specific methods. See the documentation for the decorator for more details on how this can be used.</span>

<span class="sd">    **Instance-Level Expressions:**</span>

<span class="sd">    Instance-level expressions are specific to a particular instance and can override or extend the class-level definitions.</span>
<span class="sd">    They are managed using the following methods:</span>

<span class="sd">    - **Define**: Use the :py:meth:`Profile.set_expression` method to register a symbolic expression.</span>
<span class="sd">    - **Access**: Use the :py:meth:`Profile.get_expression` method to retrieve a registered expression.</span>

<span class="sd">    .. important::</span>

<span class="sd">        The :py:meth:`Profile.get_expression` will first search for an **instance-level expression** matching the specified</span>
<span class="sd">        name; however, if it fails to find one (by default) it will the search the **class-level expressions**. If one is found,</span>
<span class="sd">        the :py:attr:`Profile.SYMBPARAMS` are substituted for the parameter values of the profile and the new instance-level expression</span>
<span class="sd">        is registered.</span>

<span class="sd">    For **instance-level** expressions, the :py:meth:`Profile.get_numeric_expression` method can be used to obtain a &quot;lambdified&quot;</span>
<span class="sd">    version of a symbolic expression suitable for numerical calculations.</span>

<span class="sd">    +-----------------------------------+--------------+-----------------------------------------------------------------------------------+</span>
<span class="sd">    | Method                            | Scope        | Purpose                                                                           |</span>
<span class="sd">    +===================================+==============+===================================================================================+</span>
<span class="sd">    | :py:meth:`set_class_expression`   | Class-Level  | Define a symbolic expression at the class level.                                  |</span>
<span class="sd">    +-----------------------------------+--------------+-----------------------------------------------------------------------------------+</span>
<span class="sd">    | :py:meth:`get_class_expression`   | Class-Level  | Retrieve a symbolic expression from the class level.                              |</span>
<span class="sd">    +-----------------------------------+--------------+-----------------------------------------------------------------------------------+</span>
<span class="sd">    | :py:meth:`set_expression`         | Instance     | Define a symbolic expression at the instance level.                               |</span>
<span class="sd">    +-----------------------------------+--------------+-----------------------------------------------------------------------------------+</span>
<span class="sd">    | :py:meth:`get_expression`         | Instance     | Retrieve a symbolic expression from the instance or, optionally, the class level. |</span>
<span class="sd">    +-----------------------------------+--------------+-----------------------------------------------------------------------------------+</span>
<span class="sd">    | :py:meth:`get_numeric_expression` | Instance     | Retrieve or create a callable numeric version of an expression.                   |</span>
<span class="sd">    +-----------------------------------+--------------+-----------------------------------------------------------------------------------+</span>


<span class="sd">    By combining these features, the :py:class:`Profile` class provides a powerful and flexible framework for</span>
<span class="sd">    modeling mathematical profiles with extensible symbolic and numeric capabilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># @@ CLASS FLAGS @@ #</span>
    <span class="c1"># These flags are used by the metaclass to determine whether or not to</span>
    <span class="c1"># treat the class specially.</span>
    <span class="n">_IS_ABC</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Mark the class as an abstract class -- the metaclass skips this class if True.</span>

    <span class="c1"># @@ CLASS ATTRIBUTES @@ #</span>
    <span class="c1"># Core attributes of the profile class.</span>
    <span class="c1">#</span>
    <span class="c1"># DEVELOPERS: These should all be set when subclassing Profile.</span>
    <span class="n">AXES</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; list of str: The axes (free parameters) of the profile.</span>
<span class="sd">        These should be strings and be specified in order. The metaclass will process</span>
<span class="sd">        them into the symbolic axes of :py:attr:`Profile.SYMBAXES`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_PARAMETERS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; dict of str, Any: The parameters of the profile.</span>
<span class="sd">        The keys of the dictionary should specify the symbol for the kwarg (its name) and the values</span>
<span class="sd">        should represent default values (``float``). These do not possess inherent units, instead, they</span>
<span class="sd">        are simply to be provided in a unit consistent way.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_UNITS</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; str: The default units of the profile.</span>
<span class="sd">        These can later be overridden by specifying the ``units`` kwarg at instantiation.</span>

<span class="sd">        .. hint::</span>

<span class="sd">            These units specify the dimensions of the profile output. If you later specify an instance of</span>
<span class="sd">            the profile with units that are inconsistent with :py:attr:`Profile.DEFAULT_UNITS`, and error is raised.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># @@ CLASS SYMBOL REGISTRIES @@ #</span>
    <span class="c1"># These should NEVER be altered -- they just hold the symbols and expressions</span>
    <span class="c1"># generated by the metaclass.</span>
    <span class="c1"># The _EXPR_DICT is simply a class-level repository for class expressions.</span>
    <span class="c1"># The _func_expr holds the class-level function expression.</span>
    <span class="n">_EXPR_DICT</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_func_expr</span><span class="p">:</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">SYMBAXES</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; list of sp.Symbol: The symbolic axes of the profile.&quot;&quot;&quot;</span>
    <span class="n">SYMBPARAMS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; dict of sp.Symbol, float: The symbolic parameters of the profile.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Profile.__init__">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.__init__.html#pisces.profiles.base.Profile.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a Profile instance with specified parameter values and units.</span>

<span class="sd">        This constructor initializes the profile by setting its parameters, units, and derived symbolic/numeric expressions.</span>
<span class="sd">        It validates the provided parameter values and ensures unit compatibility with the profile&#39;s default units.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        units : str or Unit, optional</span>
<span class="sd">            Units for the profile. If not specified, the class-level default units (:py:attr:`Profile.DEFAULT_UNITS`) will be used.</span>
<span class="sd">            Units must be compatible with the profile&#39;s defined base units.</span>
<span class="sd">        kwargs :</span>
<span class="sd">            Parameter values for the profile. Each key must correspond to a parameter defined in the :py:attr:`Profile.DEFAULT_PARAMETERS` class attribute.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If any provided parameter is not recognized, required parameters are missing, or the specified units are</span>
<span class="sd">            incompatible with the profile&#39;s base units.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Parameters provided in `kwargs` override the default values specified in the class-level `PARAMETERS` attribute.</span>
<span class="sd">        - The `units` parameter must either be a valid unit string or a `Unit` instance and must match the dimensionality</span>
<span class="sd">          of the profile&#39;s base units.</span>
<span class="sd">        - The `_setup_call_function` method is invoked to create the callable function representing the profile&#39;s mathematical expression.</span>
<span class="sd">        - Repositories for storing symbolic and numerical derived attributes (`_derived_symbolics` and `_derived_numerics`) are initialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Configure instance parameters. Ensures that only recognized parameters</span>
        <span class="c1"># are specified and propagates the defaults from the class level PARAMETERS.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_and_update_params</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;dict of str, float: The parameters of the profile.&quot;&quot;&quot;</span>

        <span class="c1"># Handle units -- Make sure they are valid when converted to the</span>
        <span class="c1"># default. This ensures dimensionality constraints.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">units</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_UNITS</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; unyt.Unit: The units for the output of this profile.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">get_conversion_factor</span><span class="p">(</span><span class="n">Unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">DEFAULT_UNITS</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Units </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="si">}</span><span class="s2"> are not consistent with base units for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">DEFAULT_UNITS</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Setup the call function.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_call_function</span><span class="p">()</span>

        <span class="c1"># Setup the repository for derived symbolics and lambdified methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_derived_symbolics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_derived_numerics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>


    <span class="k">def</span> <span class="nf">_validate_and_update_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate and update the parameters with defaults and provided values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kwargs : dict</span>
<span class="sd">            Parameter values passed during initialization.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Updated parameter dictionary.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If unexpected parameters are provided or required parameters are missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">DEFAULT_PARAMETERS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Update with user-provided parameters</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unexpected parameter: &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; not recognized in class &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Check for missing required parameters</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing required parameters for class &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">_setup_call_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup the callable function by substituting parameter values</span>
<span class="sd">        and creating a numerical function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">symbolic_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitute_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_func_expr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_function_symbolic</span> <span class="o">=</span> <span class="n">symbolic_expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambdify_expression</span><span class="p">(</span><span class="n">symbolic_expr</span><span class="p">)</span>

<div class="viewcode-block" id="Profile.substitute_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.substitute_expression.html#pisces.profiles.base.Profile.substitute_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">substitute_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Substitute the parameter values (:py:attr:`Profile.parameters`) into a symbolic expression.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression : str or sp.Basic</span>
<span class="sd">            The symbolic expression to substitute into.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sp.Basic</span>
<span class="sd">            Substituted symbolic expression.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">sympify</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span></div>


<div class="viewcode-block" id="Profile.lambdify_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.lambdify_expression.html#pisces.profiles.base.Profile.lambdify_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">lambdify_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a symbolic expression into a callable function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression : str or sp.Basic</span>
<span class="sd">            The symbolic expression to lambdify.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Callable</span>
<span class="sd">            A callable numerical function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sympify</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">SYMBAXES</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the profile&#39;s mathematical function with the given inputs.</span>

<span class="sd">        This method allows the profile instance to be used as a callable, evaluating</span>
<span class="sd">        its associated function with the provided input values for the independent variables.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : tuple</span>
<span class="sd">            Input values corresponding to the independent variables defined in the :py:attr:`Profile.AXES` class attribute.</span>
<span class="sd">            The number and order of inputs must match the defined axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Any</span>
<span class="sd">            The computed result of the profile&#39;s function evaluated at the specified inputs.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of input arguments does not match the number of independent variables (:py:attr:`Profile.AXES`).</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the input values are incompatible with the profile&#39;s function.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The profile&#39;s function is generated during initialization using symbolic expressions and lambdified for numerical evaluation.</span>
<span class="sd">        - The inputs provided must conform to the expected type and dimensionality required by the function.</span>
<span class="sd">        - This method provides a convenient interface for directly evaluating the profile, e.g., `result = profile(x, y, z)`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">param_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">param_str</span><span class="si">}</span><span class="s2">)&gt;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

<div class="viewcode-block" id="Profile.to_hdf5">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.to_hdf5.html#pisces.profiles.base.Profile.to_hdf5">[docs]</a>
    <span class="k">def</span> <span class="nf">to_hdf5</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">h5_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">],</span>
        <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the Profile instance to an HDF5 group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        h5_obj : h5py.File or h5py.Group</span>
<span class="sd">            HDF5 object where the Profile will be saved.</span>
<span class="sd">        group_name : str</span>
<span class="sd">            Name of the group in the HDF5 file.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If True, overwrite existing group with the same name.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the group already exists and overwrite is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">h5_obj</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">h5_obj</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; already exists. Use `overwrite=True` to replace it.&quot;</span>
                <span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="n">h5_obj</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;class_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">AXES</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Profile.from_hdf5">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.from_hdf5.html#pisces.profiles.base.Profile.from_hdf5">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hdf5</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">h5_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">],</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Profile&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a Profile instance from an HDF5 group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        h5_obj : h5py.File or h5py.Group</span>
<span class="sd">            HDF5 object from which the Profile will be loaded.</span>
<span class="sd">        group_name : str</span>
<span class="sd">            Name of the group in the HDF5 file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Profile</span>
<span class="sd">            An instance of the loaded Profile subclass.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the group does not exist in the HDF5 file or required attributes are missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">h5_obj</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; does not exist in the HDF5 file.&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="n">h5_obj</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>

        <span class="c1"># Load class name and ensure compatibility</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;class_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">_subcls</span> <span class="o">=</span> <span class="n">find_in_subclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>

        <span class="c1"># Load parameters and validate</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;class_name&quot;</span><span class="p">,</span> <span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">_subcls</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">parameters</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">symbolic_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The symbolic expression of the profile function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_function_symbolic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_symbolic_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The class-level symbolic expression of the profile function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_func_expr</span>

<div class="viewcode-block" id="Profile.set_class_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.set_class_expression.html#pisces.profiles.base.Profile.set_class_expression">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_class_expression</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">expression_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expression</span><span class="p">:</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a symbolic expression at the class level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression_name : str</span>
<span class="sd">            The name of the symbolic expression to register.</span>
<span class="sd">        expression : sp.Basic</span>
<span class="sd">            The symbolic expression to register.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If True, overwrite an existing expression with the same name. Defaults to False.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the expression name already exists and `overwrite` is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expression_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expression &#39;</span><span class="si">{</span><span class="n">expression_name</span><span class="si">}</span><span class="s2">&#39; already exists. Use `overwrite=True` to replace it.&quot;</span>
            <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">expression</span></div>


<div class="viewcode-block" id="Profile.get_class_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.get_class_expression.html#pisces.profiles.base.Profile.get_class_expression">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_class_expression</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">expression_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a symbolic expression registered at the class level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression_name : str</span>
<span class="sd">            The name of the symbolic expression to retrieve.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sp.Basic</span>
<span class="sd">            The requested symbolic expression.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If the requested expression name does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expression_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="p">:</span>
            <span class="n">_class_expr</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_class_expr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># This is an on-demand class expression that needs to now be loaded.</span>
                <span class="n">devlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Evaluating class expression </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">expression_name</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_class_expr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_class_expr</span><span class="p">)(</span>
                        <span class="bp">cls</span><span class="o">.</span><span class="n">SYMBAXES</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">SYMBPARAMS</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_func_expr</span>
                    <span class="p">)</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_class_expr</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to register expression &#39;</span><span class="si">{</span><span class="n">expression_name</span><span class="si">}</span><span class="s2">&#39; at class level. ERROR: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

            <span class="k">return</span> <span class="n">_class_expr</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class-level expression &#39;</span><span class="si">{</span><span class="n">expression_name</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Profile.list_class_expressions">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.list_class_expressions.html#pisces.profiles.base.Profile.list_class_expressions">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_class_expressions</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the available class-level expressions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            The list of available class-level expressions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="Profile.has_class_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.has_class_expression.html#pisces.profiles.base.Profile.has_class_expression">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">has_class_expression</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">expression_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if a symbolic expression is registered at the class level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression_name: str</span>
<span class="sd">            The name of the symbolic expression to check.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            ``True`` if the symbolic expression is registered at the class level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">expression_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_EXPR_DICT</span></div>


<div class="viewcode-block" id="Profile.get_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.get_expression.html#pisces.profiles.base.Profile.get_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">get_expression</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">expression_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">search_class</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve an instance-level or class-level symbolic expression.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression_name : str</span>
<span class="sd">            The name of the symbolic expression to retrieve.</span>
<span class="sd">        search_class : bool, optional</span>
<span class="sd">            If True, search for the expression at the class level if not found at the instance level. Defaults to False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sp.Basic</span>
<span class="sd">            The requested symbolic expression.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If the expression is not found at either the instance or class level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expression_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derived_symbolics</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derived_symbolics</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">search_class</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitute_expression</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_class_expression</span><span class="p">(</span><span class="n">expression_name</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expression &#39;</span><span class="si">{</span><span class="n">expression_name</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Profile.set_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.set_expression.html#pisces.profiles.base.Profile.set_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">set_expression</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">expression_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expression</span><span class="p">:</span> <span class="n">sp</span><span class="o">.</span><span class="n">Basic</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a symbolic expression at the instance level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression_name : str</span>
<span class="sd">            The name of the symbolic expression to register.</span>
<span class="sd">        expression : sp.Basic</span>
<span class="sd">            The symbolic expression to register.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If True, overwrite an existing expression with the same name. Defaults to False.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the expression name already exists and `overwrite` is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">expression_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derived_symbolics</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">expression_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="p">)</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expression &#39;</span><span class="si">{</span><span class="n">expression_name</span><span class="si">}</span><span class="s2">&#39; already exists. Use `overwrite=True` to replace it.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_derived_symbolics</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">expression</span></div>


<div class="viewcode-block" id="Profile.list_expressions">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.list_expressions.html#pisces.profiles.base.Profile.list_expressions">[docs]</a>
    <span class="k">def</span> <span class="nf">list_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_class_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the available instance-level expressions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        include_class_level : bool, optional</span>
<span class="sd">            If True, include the class level symbolic expressions. Defaults to True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            The list of available class-level expressions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_EXPR_DICT</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_derived_symbolics</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>


<div class="viewcode-block" id="Profile.has_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.has_expression.html#pisces.profiles.base.Profile.has_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">has_expression</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">expression_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">include_class_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if a symbolic expression is registered at the instance level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression_name: str</span>
<span class="sd">            The name of the symbolic expression to check.</span>
<span class="sd">        include_class_level : bool, optional</span>
<span class="sd">            If True, include the class level symbolic expressions. Defaults to True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            ``True`` if the symbolic expression is registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expression_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derived_symbolics</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">include_class_level</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expression_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EXPR_DICT</span>

        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Profile.get_numeric_expression">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.Profile.get_numeric_expression.html#pisces.profiles.base.Profile.get_numeric_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">get_numeric_expression</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">expression_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">search_class</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve or create a numeric (callable) version of a symbolic expression.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expression_name : str</span>
<span class="sd">            The name of the symbolic expression to retrieve or convert.</span>
<span class="sd">        search_class : bool, optional</span>
<span class="sd">            If True, search for the expression at the class level if not found at the instance level. Defaults to False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Callable</span>
<span class="sd">            A numeric (callable) version of the symbolic expression.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If the symbolic expression is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expression_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derived_numerics</span><span class="p">:</span>
            <span class="n">symbolic_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span>
                <span class="n">expression_name</span><span class="p">,</span> <span class="n">search_class</span><span class="o">=</span><span class="n">search_class</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_derived_numerics</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambdify_expression</span><span class="p">(</span>
                <span class="n">symbolic_expression</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derived_numerics</span><span class="p">[</span><span class="n">expression_name</span><span class="p">]</span></div>
</div>



<div class="viewcode-block" id="RadialProfile">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.RadialProfile.html#pisces.profiles.base.RadialProfile">[docs]</a>
<span class="k">class</span> <span class="nc">RadialProfile</span><span class="p">(</span><span class="n">Profile</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for radial profiles.</span>

<span class="sd">    This class extends the :py:class:`Profile` to include methods specific to radial profiles,</span>
<span class="sd">    particularly the ability to extract limiting power-law behaviors at small (inner) or large (outer)</span>
<span class="sd">    radii.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_IS_ABC</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Class attribute for the radial axis</span>
    <span class="n">AXES</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    list of str: The axes (free parameters) of the profile.</span>
<span class="sd">        These should be strings and specified in order. The metaclass processes</span>
<span class="sd">        them into symbolic axes via :py:attr:`Profile.SYMBAXES`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@class_expression</span><span class="p">(</span><span class="s2">&quot;derivative&quot;</span><span class="p">,</span> <span class="n">on_demand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_r_derivative</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="c1"># Determines the derivative of the profile with respect to radius.</span>
        <span class="c1"># This is ON_DEMAND, so we only grab this when it&#39;s requested.</span>
        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<div class="viewcode-block" id="RadialProfile.get_limiting_behavior">
<a class="viewcode-back" href="../../../_as_gen/pisces.profiles.base.RadialProfile.get_limiting_behavior.html#pisces.profiles.base.RadialProfile.get_limiting_behavior">[docs]</a>
    <span class="k">def</span> <span class="nf">get_limiting_behavior</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the coefficient and power of the dominant power-law term</span>
<span class="sd">        for the radial profile in the specified limit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        limit : str, optional</span>
<span class="sd">            Specifies the limit to analyze. Options are:</span>

<span class="sd">            - &#39;inner&#39;: As :math:`r \to 0`.</span>
<span class="sd">            - &#39;outer&#39;: As :math:`r \to \infty`.</span>

<span class="sd">            Default is &#39;inner&#39;.</span>
<span class="sd">        strict : bool, optional</span>
<span class="sd">            If True, raises any exceptions encountered during the calculation.</span>
<span class="sd">            If False, suppresses exceptions and returns None on failure.</span>
<span class="sd">            Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of float or None</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">            - Coefficient (float): The prefactor of the dominant power-law term.</span>
<span class="sd">            - Power (float): The exponent of the dominant power-law term.</span>
<span class="sd">            Returns None if the analysis fails and `strict` is False.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the limit is invalid or symbolic expansion fails, and `strict` is True.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method relies on the utility function :py:func:`get_powerlaw_limit` to perform</span>
<span class="sd">        symbolic series expansion and determine the dominant term.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        The Hernquist profile takes the form</span>

<span class="sd">        .. math::</span>

<span class="sd">            \rho(r) = \frac{\rho_0}{\xi(\xi +1)^3},</span>

<span class="sd">        where :math:`\xi = r/r_s`. Now, in the limit as :math:`r \to \infty`, this clearly goes as</span>
<span class="sd">        :math:`\rho_0/\xi^{-4}`, while as :math:`r \to 0`, :math:`\rho \to \rho_0/\xi^{-1}`. We should</span>
<span class="sd">        obtain the same answer from this method:</span>

<span class="sd">        .. plot::</span>

<span class="sd">            &gt;&gt;&gt; from pisces.profiles.density import HernquistDensityProfile</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; density_profile = HernquistDensityProfile(rho_0=5,r_s=1)</span>
<span class="sd">            &gt;&gt;&gt; _inner_lim = density_profile.get_limiting_behavior(limit=&#39;inner&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _outer_lim = density_profile.get_limiting_behavior(limit=&#39;outer&#39;)</span>

<span class="sd">            Let&#39;s now use this information to make a plot of our profile and its limiting behavior:</span>

<span class="sd">            &gt;&gt;&gt; fig,axes = plt.subplots(1,1)</span>
<span class="sd">            &gt;&gt;&gt; r = np.logspace(-3,3,1000)</span>
<span class="sd">            &gt;&gt;&gt; _ = axes.loglog(r,density_profile(r),label=r&#39;$\rho(r)$&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _ = axes.loglog(r, _outer_lim[0]*(r**_outer_lim[1]), label=r&#39;$\lim_{r \to \infty} \rho(r)$&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _ = axes.loglog(r, _inner_lim[0]*(r**_inner_lim[1]), label=r&#39;$\lim_{r \to 0} \rho(r)$&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _ = axes.set_ylim([1e-6,1e5])</span>
<span class="sd">            &gt;&gt;&gt; _ = axes.set_xlim([1e-3,1e3])</span>
<span class="sd">            &gt;&gt;&gt; _ = axes.set_xlabel(&#39;r&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _ = axes.set_ylabel(&#39;density(r)&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _ = axes.legend(loc=&#39;best&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pisces.utilities.math_utils.symbolic</span> <span class="kn">import</span> <span class="n">get_powerlaw_limit</span>

        <span class="c1"># Validate the symbolic expression and axis</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;symbolic_expression&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The profile lacks a valid symbolic expression.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">SYMBAXES</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SYMBAXES</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The profile must define at least one symbolic axis (&#39;r&#39;).&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Extract the symbolic radial axis</span>
            <span class="n">r_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SYMBAXES</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">get_powerlaw_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic_expression</span><span class="p">,</span> <span class="n">r_symbol</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to determine limiting behavior: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>
</div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Eliza Diggins.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>